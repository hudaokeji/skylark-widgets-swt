{"version":3,"sources":["Toolbar.js"],"names":["define","langx","$","Widget","Toolbar","inherit","options","toolbar","toolbarFloat","toolbarHidden","toolbarFloatOffset","template","separator","_construct","editor","opts","this","prototype","call","_init","floatInitialized","initToolbarFloat","toolbarHeight","_this","_render","list","on","e","wrapper","find","removeClass","document","id","css","width","editable","util","reflow","outerWidth","os","mobile","position","left","offset","outerHeight","placeholderEl","window","bottomEdge","scrollTop","topEdge","is","top","addClass","buttons","length","pluginName","_tpl","k","len","name","ref","_elm","prependTo","constructor","Error","push","appendTo","hide","findButton","button","data","addButton","btn"],"mappings":"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","file":"../Toolbar.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-utils-dom/query\",\r\n  \"skylark-widgets-base/Widget\"\r\n],function(langx,$,Widget){ \r\n\r\n\r\n\r\n  var Toolbar = Widget.inherit({\r\n    options : {\r\n      toolbar: true,\r\n      toolbarFloat: true,\r\n      toolbarHidden: false,\r\n      toolbarFloatOffset: 0,\r\n      template : '<div class=\"richeditor-toolbar\"><ul></ul></div>',\r\n      separator : {\r\n        template :  '<li><span class=\"separator\"></span></li>'\r\n      }\r\n    },\r\n\r\n\r\n    _construct : function(editor,opts) {\r\n      this.editor =editor;\r\n      Widget.prototype._construct.call(this,opts);\r\n    },\r\n\r\n    _init : function(editor,opts) {\r\n      var floatInitialized, initToolbarFloat, toolbarHeight;\r\n      //this.editor = editor;\r\n\r\n      //this.opts = langx.extend({}, this.opts, opts);\r\n      this.opts = this.options;\r\n\r\n      if (!this.opts.toolbar) {\r\n        return;\r\n      }\r\n      //if (!langx.isArray(this.opts.toolbar)) {\r\n      //  this.opts.toolbar = ['bold', 'italic', 'underline', 'strikethrough', '|', 'ol', 'ul', 'blockquote', 'code', '|', 'link', 'image', '|', 'indent', 'outdent'];\r\n      //}\r\n      this._render();\r\n      this.list.on('click', function(e) {\r\n        return false;\r\n      });\r\n      this.wrapper.on('mousedown', (function(_this) {\r\n        return function(e) {\r\n          return _this.list.find('.menu-on').removeClass('.menu-on');\r\n        };\r\n      })(this));\r\n      $(document).on('mousedown.richeditor' + this.editor.id, (function(_this) {\r\n        return function(e) {\r\n          return _this.list.find('.menu-on').removeClass('.menu-on');\r\n        };\r\n      })(this));\r\n      if (!this.opts.toolbarHidden && this.opts.toolbarFloat) {\r\n        this.wrapper.css('top', this.opts.toolbarFloatOffset);\r\n        toolbarHeight = 0;\r\n        initToolbarFloat = (function(_this) {\r\n          return function() {\r\n            _this.wrapper.css('position', 'static');\r\n            _this.wrapper.width('auto');\r\n            _this.editor.editable.util.reflow(_this.wrapper);\r\n            _this.wrapper.width(_this.wrapper.outerWidth());\r\n            _this.wrapper.css('left', _this.editor.editable.util.os.mobile ? _this.wrapper.position().left : _this.wrapper.offset().left);\r\n            _this.wrapper.css('position', '');\r\n            toolbarHeight = _this.wrapper.outerHeight();\r\n            _this.editor.placeholderEl.css('top', toolbarHeight);\r\n            return true;\r\n          };\r\n        })(this);\r\n        floatInitialized = null;\r\n        $(window).on('resize.richeditor-' + this.editor.id, function(e) {\r\n          return floatInitialized = initToolbarFloat();\r\n        });\r\n        $(window).on('scroll.richeditor-' + this.editor.id, (function(_this) {\r\n          return function(e) {\r\n            var bottomEdge, scrollTop, topEdge;\r\n            if (!_this.wrapper.is(':visible')) {\r\n              return;\r\n            }\r\n            topEdge = _this.editor.wrapper.offset().top;\r\n            bottomEdge = topEdge + _this.editor.wrapper.outerHeight() - 80;\r\n            scrollTop = $(document).scrollTop() + _this.opts.toolbarFloatOffset;\r\n            if (scrollTop <= topEdge || scrollTop >= bottomEdge) {\r\n              _this.editor.wrapper.removeClass('toolbar-floating').css('padding-top', '');\r\n              if (_this.editor.editable.util.os.mobile) {\r\n                return _this.wrapper.css('top', _this.opts.toolbarFloatOffset);\r\n              }\r\n            } else {\r\n              floatInitialized || (floatInitialized = initToolbarFloat());\r\n              _this.editor.wrapper.addClass('toolbar-floating').css('padding-top', toolbarHeight);\r\n              if (_this.editor.editable.util.os.mobile) {\r\n                return _this.wrapper.css('top', scrollTop - topEdge + _this.opts.toolbarFloatOffset);\r\n              }\r\n            }\r\n          };\r\n        })(this));\r\n      }\r\n      this.editor.on('destroy', (function(_this) {\r\n        return function() {\r\n          return _this.buttons.length = 0;\r\n        };\r\n      })(this));\r\n      $(document).on(\"mousedown.richeditor-\" + this.editor.id, (function(_this) {\r\n        return function(e) {\r\n          return _this.list.find('li.menu-on').removeClass('menu-on');\r\n        };\r\n      })(this));\r\n    }\r\n\r\n  });\r\n\r\n  Toolbar.pluginName = 'Toolbar';\r\n\r\n\r\n\r\n  Toolbar.prototype._tpl = {\r\n    wrapper: '<div class=\"richeditor-toolbar\"><ul></ul></div>',\r\n    separator: '<li><span class=\"separator\"></span></li>'\r\n  };\r\n\r\n\r\n  Toolbar.prototype._render = function() {\r\n    var k, len, name, ref;\r\n    this.buttons = [];\r\n    //this.wrapper = $(this._tpl.wrapper).prependTo(this.editor.wrapper);\r\n    this.wrapper = $(this._elm).prependTo(this.editor.wrapper);\r\n    this.list = this.wrapper.find('ul');\r\n    ref = this.opts.toolbar;\r\n    for (k = 0, len = ref.length; k < len; k++) {\r\n      name = ref[k];\r\n      if (name === '|') {\r\n        //$(this._tpl.separator).appendTo(this.list);\r\n        $(this.options.separator.template).appendTo(this.list);\r\n        continue;\r\n      }\r\n      if (!this.constructor.buttons[name]) {\r\n        throw new Error(\"richeditor: invalid toolbar button \" + name);\r\n        continue;\r\n      }\r\n      this.buttons.push(new this.constructor.buttons[name]({\r\n        toolbar : this,\r\n        editor: this.editor\r\n      }));\r\n    }\r\n    if (this.opts.toolbarHidden) {\r\n      return this.wrapper.hide();\r\n    }\r\n  };\r\n\r\n  Toolbar.prototype.findButton = function(name) {\r\n    var button;\r\n    button = this.list.find('.toolbar-item-' + name).data('button');\r\n    return button != null ? button : null;\r\n  };\r\n\r\n  Toolbar.addButton = function(btn) {\r\n    return this.buttons[btn.prototype.name] = btn;\r\n  };\r\n\r\n  Toolbar.buttons = {};\r\n\r\n  return Toolbar;\r\n\r\n});"]}