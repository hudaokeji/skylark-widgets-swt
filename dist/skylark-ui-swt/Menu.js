/**
 * skylark-ui-swt - The skylark widget framework and standard widgets
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-swt/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/browser","skylark-utils-dom/eventer","skylark-utils-dom/noder","skylark-utils-dom/geom","skylark-utils-dom/query","./ui","./Widget"],function(t,e,a,i,n,s,o,l){var r,c=null,h=o.Menu=l.inherit({klassName:"Menu",pluginName:"lark.menu",init:function(e,a){a||(a=e,e=null);var n,o=this;this._options=t.mixin({hide_onmouseleave:0,icons:!0},a),n=e?this.$el=s(e):this.$el=s("<ul class='vakata-context'></ul>");var l=!1;n.on("mouseenter","li",function(t){t.stopImmediatePropagation(),i.contains(this,t.relatedTarget)||(l&&clearTimeout(l),n.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),s(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),o._show_submenu(this))}).on("mouseleave","li",function(t){i.contains(this,t.relatedTarget)||s(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){s(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),o._options.hide_onmouseleave&&(l=setTimeout(function(t){return function(){o.hide()}}(this),o._options.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),s(this).blur().parent().hasClass("vakata-context-disabled")||o._execute(s(this).attr("rel"))===!1||o.hide()}).on("keydown","a",function(t){var e=null;switch(t.which){case 13:case 32:t.type="click",t.preventDefault(),s(t.currentTarget).trigger(t);break;case 37:o.$el.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault();break;case 38:e=o.$el.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),e.length||(e=o.$el.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),e.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault();break;case 39:o.$el.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault();break;case 40:e=o.$el.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),e.length||(e=o.$el.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),e.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault();break;case 27:o.hide(),t.preventDefault()}}).on("keydown",function(t){t.preventDefault();var e=o.$el.find(".vakata-contextmenu-shortcut-"+t.which).parent();e.parent().not(".vakata-context-disabled")&&e.click()}),this.render()},render:function(){var t=this._options.items;this._parse(t)&&this.$el.html(this.html),this.$el.width("")},_trigger:function(t){s(document).trigger("context_"+t+".sbswt",{reference:this.reference,element:this.$el,position:{x:this.position_x,y:this.position_y}})},_execute:function(e){return e=this.items[e],!(!e||e._disabled&&(!t.isFunction(e._disabled)||e._disabled({item:e,reference:this.reference,element:this.$el}))||!e.action)&&e.action.call(null,{item:e,reference:this.reference,element:this.$el,position:{x:this.position_x,y:this.position_y}})},_parse:function(e,a){var i=this,n=i._options.reference;if(!e)return!1;a||(i.html="",i.items=[]);var s,o="",l=!1;return a&&(o+="<ul>"),t.each(e,function(e,a){return!a||(i.items.push(a),!l&&a.separator_before&&(o+="<li class='vakata-context-separator'><a href='#' "+(i._options.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),l=!1,o+="<li class='"+(a._class||"")+(a._disabled===!0||t.isFunction(a._disabled)&&a._disabled({item:a,reference:n,element:i.$el})?" vakata-contextmenu-disabled ":"")+"' "+(a.shortcut?" data-shortcut='"+a.shortcut+"' ":"")+">",o+="<a href='#' rel='"+(i.items.length-1)+"' "+(a.title?"title='"+a.title+"'":"")+">",i._options.icons&&(o+="<i ",a.icon&&(o+=a.icon.indexOf("/")!==-1||a.icon.indexOf(".")!==-1?" style='background:url(\""+a.icon+"\") center center no-repeat' ":" class='"+a.icon+"' "),o+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),o+=(t.isFunction(a.label)?a.label({item:e,reference:n,element:i.$el}):a.label)+(a.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+a.shortcut+'">'+(a.shortcut_label||"")+"</span>":"")+"</a>",a.submenu&&(s=i._parse(a.submenu,!0),s&&(o+=s)),o+="</li>",void(a.separator_after&&(o+="<li class='vakata-context-separator'><a href='#' "+(i._options.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",l=!0)))}),o=o.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),a&&(o+="</ul>"),a||(i.html=o,i._trigger("parse")),o.length>10&&o},_show_submenu:function(t){if(t=s(t),t.length&&t.children("ul").length){var e=t.children("ul"),a=t.offset().left,i=a+t.outerWidth(),n=t.offset().top,o=e.width(),l=e.height(),c=s(window).width()+s(window).scrollLeft(),h=s(window).height()+s(window).scrollTop();r?t[i-(o+10+t.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):t[i+o>c&&a>c-i?"addClass":"removeClass"]("vakata-context-right"),n+l+10>h&&e.css("bottom","-1px"),t.hasClass("vakata-context-right")?a<o&&e.css("margin-right",a-o):c-i<o&&e.css("margin-left",c-i-o),e.show()}},show:function(t,e,a){var i,n,o,l,h,d,u,v,f=!0;switch(f){case!e&&!t:return!1;case!!e&&!!t:this.reference=t,this.position_x=e.x,this.position_y=e.y;break;case!e&&!!t:this.reference=t,i=t.offset(),this.position_x=i.left+t.outerHeight(),this.position_y=i.top;break;case!!e&&!t:this.position_x=e.x,this.position_y=e.y}t&&!a&&s(t).data("vakata_contextmenu")&&(a=s(t).data("vakata_contextmenu")),this.items.length&&(this.$el.appendTo(document.body),n=this.$el,o=this.position_x,l=this.position_y,h=n.width(),d=n.height(),u=s(window).width()+s(window).scrollLeft(),v=s(window).height()+s(window).scrollTop(),r&&(o-=n.outerWidth()-s(t).outerWidth(),o<s(window).scrollLeft()+20&&(o=s(window).scrollLeft()+20)),o+h+20>u&&(o=u-(h+20)),l+d+20>v&&(l=v-(d+20)),this.$el.css({left:o,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),this.is_visible=!0,c=this,this._trigger("show"))},hide:function(){this.is_visible&&(this.$el.hide().find("ul").hide().end().find(":focus").blur().end().detach(),this.is_visible=!1,c=null,this._trigger("hide"))}});return s(function(){r="rtl"===s(document.body).css("direction"),s(document).on("mousedown.sbswt.popup",function(t){c&&c.$el[0]!==t.target&&!i.contains(c.$el[0],t.target)&&c.hide()}).on("context_show.sbswt.popup",function(t,e){c.$el.find("li:has(ul)").children("a").addClass("vakata-context-parent"),r&&c.$el.addClass("vakata-context-rtl").css("direction","rtl"),c.$el.find("ul").hide().end()})}),h.popup=function(t,e,a){var i=new h({reference:t,items:a});i.show(t,e)},h.hide=function(){c&&c.hide()},h});
//# sourceMappingURL=sourcemaps/Menu.js.map
