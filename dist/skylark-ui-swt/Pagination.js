/**
 * skylark-ui-swt - The skylark widget framework and standard widgets
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-swt/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/browser","skylark-utils-dom/eventer","skylark-utils-dom/noder","skylark-utils-dom/geom","skylark-utils-dom/query","./ui","./Widget"],function(t,s,e,i,a,n,o,r){"use strict";var l=o.Pagination=r.inherit({klassName:"Pagination",pluginName:"lark.pagination",options:{totalPages:1,startPage:1,visiblePages:5,initiateStartPageClick:!0,hideOnlyOnePage:!1,href:!1,pageVariable:"{{page}}",totalPagesVariable:"{{total_pages}}",page:null,first:"First",prev:"Previous",next:"Next",last:"Last",loop:!1,beforePageClick:null,onPageClick:null,paginationClass:"pagination",nextClass:"page-item next",prevClass:"page-item prev",lastClass:"page-item last",firstClass:"page-item first",pageClass:"page-item",activeClass:"active",disabledClass:"disabled",anchorClass:"page-link"},_create:function(t,s){if(this.$element=n(t),this.options=n.extend({},n.fn.twbsPagination.defaults,s),this.options.startPage<1||this.options.startPage>this.options.totalPages)throw new Error("Start page option is incorrect");if(this.options.totalPages=parseInt(this.options.totalPages),isNaN(this.options.totalPages))throw new Error("Total pages option is not correct!");if(this.options.visiblePages=parseInt(this.options.visiblePages),isNaN(this.options.visiblePages))throw new Error("Visible pages option is not correct!");if(this.options.beforePageClick instanceof Function&&this.$element.first().on("beforePage",this.options.beforePageClick),this.options.onPageClick instanceof Function&&this.$element.first().on("page",this.options.onPageClick),this.options.hideOnlyOnePage&&1==this.options.totalPages)return this.options.initiateStartPageClick&&this.$element.trigger("page",1),this;this.options.href&&(this.options.startPage=this.getPageFromQueryString(),this.options.startPage||(this.options.startPage=1));var e="function"==typeof this.$element.prop?this.$element.prop("tagName"):this.$element.attr("tagName");if("UL"===e)this.$listContainer=this.$element;else{var i=this.$element,a=n([]);i.each(function(t){var s=n("<ul></ul>");n(this).append(s),a.push(s[0])}),this.$listContainer=a,this.$element=a}return this.$listContainer.addClass(this.options.paginationClass),this.options.initiateStartPageClick?this.show(this.options.startPage):(this.currentPage=this.options.startPage,this.render(this.getPages(this.options.startPage)),this.setupEvents()),this},_destroy:function(){return this.$element.empty(),this.$element.removeData("twbs-pagination"),this.$element.off("page"),this},show:function(t){if(t<1||t>this.options.totalPages)throw new Error("Page is incorrect.");this.currentPage=t,this.$element.trigger("beforePage",t);var s=this.getPages(t);return this.render(s),this.setupEvents(),this.$element.trigger("page",t),s},enable:function(){this.show(this.currentPage)},disable:function(){var t=this;this.$listContainer.off("click").on("click","li",function(t){t.preventDefault()}),this.$listContainer.children().each(function(){var s=n(this);s.hasClass(t.options.activeClass)||n(this).addClass(t.options.disabledClass)})},_build:function(t){var s=[];if(this.options.first&&s.push(this.buildItem("first",1)),this.options.prev){var e=t.currentPage>1?t.currentPage-1:this.options.loop?this.options.totalPages:1;s.push(this.buildItem("prev",e))}for(var i=0;i<t.numeric.length;i++)s.push(this.buildItem("page",t.numeric[i]));if(this.options.next){var a=t.currentPage<this.options.totalPages?t.currentPage+1:this.options.loop?1:this.options.totalPages;s.push(this.buildItem("next",a))}return this.options.last&&s.push(this.buildItem("last",this.options.totalPages)),s},_buildItem:function(t,s){var e=n("<li></li>"),i=n("<a></a>"),a=this.options[t]?this.makeText(this.options[t],s):s;return e.addClass(this.options[t+"Class"]),e.data("page",s),e.data("page-type",t),e.append(i.attr("href",this.makeHref(s)).addClass(this.options.anchorClass).html(a)),e},getPages:function(t){var s=[],e=Math.floor(this.options.visiblePages/2),i=t-e+1-this.options.visiblePages%2,a=t+e,n=this.options.visiblePages;n>this.options.totalPages&&(n=this.options.totalPages),i<=0&&(i=1,a=n),a>this.options.totalPages&&(i=this.options.totalPages-n+1,a=this.options.totalPages);for(var o=i;o<=a;)s.push(o),o++;return{currentPage:t,numeric:s}},render:function(t){var s=this;this.$listContainer.children().remove();var e=this.buildListItems(t);n.each(e,function(t,e){s.$listContainer.append(e)}),this.$listContainer.children().each(function(){var e=n(this),i=e.data("page-type");switch(i){case"page":e.data("page")===t.currentPage&&e.addClass(s.options.activeClass);break;case"first":e.toggleClass(s.options.disabledClass,1===t.currentPage);break;case"last":e.toggleClass(s.options.disabledClass,t.currentPage===s.options.totalPages);break;case"prev":e.toggleClass(s.options.disabledClass,!s.options.loop&&1===t.currentPage);break;case"next":e.toggleClass(s.options.disabledClass,!s.options.loop&&t.currentPage===s.options.totalPages)}})},setupEvents:function(){var t=this;this.$listContainer.off("click").on("click","li",function(s){var e=n(this);return!e.hasClass(t.options.disabledClass)&&!e.hasClass(t.options.activeClass)&&(!t.options.href&&s.preventDefault(),void t.show(parseInt(e.data("page"))))})},changeTotalPages:function(t,s){return this.options.totalPages=t,this.show(s)},makeHref:function(t){return this.options.href?this.generateQueryString(t):"#"},makeText:function(t,s){return t.replace(this.options.pageVariable,s).replace(this.options.totalPagesVariable,this.options.totalPages)},getPageFromQueryString:function(t){var s=this.getSearchString(t),e=new RegExp(this.options.pageVariable+"(=([^&#]*)|&|#|$)"),i=e.exec(s);return i&&i[2]?(i=decodeURIComponent(i[2]),i=parseInt(i),isNaN(i)?null:i):null},generateQueryString:function(t,s){var e=this.getSearchString(s),i=new RegExp(this.options.pageVariable+"=*[^&#]*");return e?"?"+e.replace(i,this.options.pageVariable+"="+t):""},getSearchString:function(t){var s=t||window.location.search;return""===s?null:(0===s.indexOf("?")&&(s=s.substr(1)),s)},getCurrentPage:function(){return this.currentPage},getTotalPages:function(){return this.options.totalPages}});return n.fn.twbsPagination=function(t){var s,e=Array.prototype.slice.call(arguments,1),i=n(this),a=i.data("twbs-pagination"),o="object"==typeof t?t:{};return a||i.data("twbs-pagination",a=new TwbsPagination(this,o)),"string"==typeof t&&(s=a[t].apply(a,e)),void 0===s?i:s},l});
//# sourceMappingURL=sourcemaps/Pagination.js.map
